<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeshNotes</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Header -->
    <header id="header">
        <h1>MeshNotes <span class="subtitle">â€“ 3D Annotation Tool for Research & Heritage</span></h1>
        <div class="header-buttons">
            <button id="btn-about">About / Help</button>
            <button id="btn-legal">Legal / Data</button>
        </div>
    </header>

    <!-- About Modal -->
    <div id="about-overlay">
        <div id="about-modal">
            <div id="about-modal-header">
                <h2>MeshNotes</h2>
                <button id="about-modal-close">âœ•</button>
            </div>
            <div id="about-modal-content">
                <section>
                    <h3>About</h3>
                    <p>
                        <strong>MeshNotes</strong> is a free, browser-based tool for annotating 3D models with points, lines, polygons, and surfaces, 
                        designed for cultural heritage documentation. It allows teams to collaboratively mark and describe features 
                        on 3D models of archaeological sites, architecture, and artifacts (e.g. from photogrammetry, laser scanning, or structured light scanning).
                    </p>
                    <p>
                        Key features include multi-entry annotations (multiple users can add observations to the same feature with individual timestamps), 
                        measurement tools, customizable groups with color coding, draggable points for editing, and <strong>W3C Web Annotation</strong> compliant export/import for interoperability and team collaboration.
                    </p>
                    <p>
                        The tool runs entirely in your browser â€” no installation or server required. Simply open the HTML file and start annotating. 
                        Your data stays on your computer unless you share the exported file. The export format follows the 
                        <a href="https://www.w3.org/TR/annotation-model/" target="_blank">W3C Web Annotation Data Model</a>, 
                        ensuring compatibility with IIIF-based systems and other annotation tools.
                    </p>
                </section>

                <section>
                    <h3>Contact</h3>
                    <div class="contact-info">
                        <p><strong>Developer:</strong> Nils Schnorr</p>
                        <p><strong>Email:</strong> <a href="mailto:nils.schnorr@uni-saarland.de">nils.schnorr@uni-saarland.de</a></p>
                        <p><strong>Institution:</strong> Department of Classical Archaeology, Saarland University, SaarbrÃ¼cken, Germany</p>
                    </div>
                </section>

                <section>
                    <h3>Quick Start</h3>
                    <div style="background: #041D31; padding: 16px; border-radius: 6px;">
                        <p style="margin-bottom: 12px;"><strong>1. Load a model</strong> â€” Click <strong>Load Model</strong> and select a 3D model file (.glb, .gltf, .obj, or .ply format). For OBJ files, you will be prompted to optionally add material (.mtl) and texture files.</p>
                        <p style="margin-bottom: 12px;"><strong>2. Add annotations</strong> â€” Select a tool (Point, Line, Polygon, or Surface) and click on the model. Double-click to finish lines/polygons/surfaces.</p>
                        <p style="margin-bottom: 12px;"><strong>3. Navigate annotations</strong> â€” Single-click an annotation in the sidebar to focus the camera on it. Double-click to open it for editing.</p>
                        <p style="margin-bottom: 12px;"><strong>4. Adjust annotations</strong> â€” When no tool is active, drag any annotation point to reposition it. Use groups to organize and color-code your work.</p>
                        <p style="margin-bottom: 12px;"><strong>5. Take measurements</strong> â€” Use the Measure tool to click two points and get the distance. Press Escape to clear.</p>
                        <p style="margin-bottom: 0;"><strong>6. Export your work</strong> â€” Click <strong>JSON</strong> to save annotations for backup or team sharing. Click <strong>PDF</strong> to generate a documentation report with screenshots.</p>
                    </div>
                </section>

                <section>
                    <h3>Manual</h3>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Loading a Model</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Click <strong>Load Model</strong> to open a 3D model file. The tool supports <code>.glb</code>, <code>.gltf</code>, <code>.obj</code>, and <code>.ply</code> formats. After loading, the face count is displayed in the bottom-right corner.</p>
                            
                            <p style="margin-top: 10px;"><strong>PLY Files:</strong> When loading a PLY file, you will be asked whether to add a texture image. If your PLY contains UV coordinates, the texture will be mapped onto the model. PLY files with vertex colors are loaded automatically without requiring a separate texture.</p>
                            
                            <p style="margin-top: 10px;"><strong>OBJ Files:</strong> When loading an OBJ file, you will be asked whether to add material and texture files. You can select a <code>.mtl</code> file together with texture images (<code>.jpg</code>, <code>.png</code>), or only texture images, or load the geometry without any materials. If only a texture is provided without an MTL file, it will be applied as a diffuse map.</p>
                            
                            <p style="margin-top: 10px;"><strong>Model Orientation:</strong> Ensure your model is oriented correctly (typically Y-up or Z-up) before exporting. The viewer's navigation is based on the model's original orientation and cannot be changed after loading. If your model appears upside down or sideways, re-export it with the correct orientation in your 3D software.</p>
                            <p style="margin-top: 10px;"><strong>Tip:</strong> GLB is recommended for best compatibility as it embeds textures and orientation in a single file. If your model is in another format, you can convert it using <a href="https://www.blender.org/" target="_blank">Blender</a>.</p>
                            <div class="limitation-note" style="margin-top: 12px;">
                                <strong>Exporting Vertex Colors from Blender:</strong> To include vertex colors in your GLB export, go to <code>File â†’ Export â†’ glTF 2.0</code>. In the export panel, expand <strong>Mesh</strong>, then <strong>Vertex Colors</strong>, and set <strong>Use Vertex Color</strong> to <strong>Active</strong>. This ensures that vertex color data is included in the GLB file and will be available in the Colors display mode.
                            </div>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Model Preparation &amp; Format Guide</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>MeshNotes works with 3D models in <code>.glb</code>, <code>.gltf</code>, <code>.obj</code>, and <code>.ply</code> formats. Choosing the right format and preparing your model well will give you the best experience.</p>

                            <p style="margin-top: 10px;"><strong>Recommended format:</strong> <code>GLB</code> (Binary glTF) is the best all-around choice. It packages geometry, textures, and materials into a single file, loads quickly, and does not allow for misleading axial orientation</p>

                            <p style="margin-top: 10px;"><strong>Format comparison:</strong></p>
                            <ul style="margin: 8px 0 0 20px; padding: 0;">
                                <li><strong>GLB/GLTF</strong> â€” Best overall. Single file (GLB) or folder with linked textures (GLTF). Supports textures, materials, and vertex colors.</li>
                                <li><strong>OBJ</strong> â€” Widely supported format. Requires separate <code>.mtl</code> and texture files. Often used for models from photogrammetry or SLS software.</li>
                                <li><strong>PLY</strong> â€” Common for point clouds and laser scans, standart format for e.g. GigaMesh. Supports vertex colors natively.</li>
                            </ul>

                            <p style="margin-top: 10px;"><strong>Face count &amp; performance:</strong> The number of faces (triangles) in your model directly affects performance. After loading, the face count is displayed in the bottom-right corner with a color indicator:</p>
                            
                            <p style="margin-top: 10px;"><strong>Orientation:</strong> When loading OBJ or PLY files, MeshNotes will ask you which axis is "up" in your source software. Most photogrammetry and cultural heritage tools (Metashape, CloudCompare, MeshLab, Blender) use <strong>Z-up</strong>, while some game engines and web viewers use Y-up. Selecting the correct option ensures your model displays upright. GLB/GLTF files handle orientation automatically per the glTF specification. See the <em>Coordinate System</em> section below for more details.</p>

                            <p style="margin-top: 10px;"><strong>Units:</strong> MeshNotes displays distances and scalebar values in whatever unit your model was created with. If your photogrammetry software exports in meters, distances will be in meters. If it exports in millimeters, they will be in millimeters. There is no unit conversion â€” consistency depends on your source data. Check your 3D software's export settings if distances seem off by a factor of 1000.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Coordinate System</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>MeshNotes displays all models and exports all annotation coordinates with <strong>Z pointing up</strong>. This matches the convention used by most software in cultural heritage, photogrammetry, and geospatial work, including Metashape, CloudCompare, MeshLab, QGIS, and Blender.</p>

                            <p style="margin-top: 10px;"><strong>Why this matters:</strong> When you annotate a model in MeshNotes and export the annotations as JSON, the coordinates in that file use Z-up. If a colleague opens the same model in a different software and overlays your annotations, the points will be in the correct positions â€” no manual coordinate conversion needed.</p>

                            <p style="margin-top: 10px;"><strong>How it works internally:</strong> The 3D engine that MeshNotes is built on (Three.js) uses Y-up internally, which is common for web-based 3D viewers. MeshNotes handles the translation between these two conventions automatically, so you never need to worry about it. The View Helper in the top-right corner always shows Z (blue) pointing up, Y (green) pointing forward, and X (red) pointing right, reflecting the Z-up convention most users will be used to.</p>

                            <p style="margin-top: 10px;"><strong>On import:</strong> When loading OBJ or PLY files, MeshNotes asks which axis is up in your source software and rotates the model accordingly. GLB/GLTF files always use Y-up by specification, so MeshNotes handles them automatically. When importing annotation files, MeshNotes checks the <code>upAxis</code> field in the JSON. Files marked as Z-up are loaded directly; older files without this field are treated as legacy Y-up data and converted automatically.</p>

                            <p style="margin-top: 10px;"><strong>On export:</strong> All annotation JSON files include an <code>"upAxis": "Z"</code> field near the top of the file. This tells any software reading the file which coordinate convention to expect. The field is deliberately not prefixed with a MeshNotes-specific namespace, so it is easy for other tools to read and interpret.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Texture &amp; Display Controls</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p><strong>Display Mode:</strong> Click the display button to cycle through three modes: <strong>Texture</strong> (shows the model's texture maps), <strong>Colors</strong> (shows vertex colors only, if present), and <strong>Gray</strong> (plain geometry without any color). The Colors mode is only available if the model contains vertex color data.</p>
                            <p style="margin-top: 10px;"><strong>Brightness slider:</strong> Adjust scene lighting from 0% to 300%. <strong>Opacity slider:</strong> Make the model transparent (10-100%) to see annotations that pass through it.</p>
                            <p style="margin-top: 10px;"><strong>Annotation Display:</strong> Use the <strong>Point Size</strong> slider (25-500%) to adjust the size of annotation markers, and the <strong>Text Size</strong> slider (25-300%) to adjust annotation label sizes. These settings are saved automatically.</p>
                            <p style="margin-top: 10px;"><strong>Light Source:</strong> By default, the main light follows your camera view, ensuring consistent illumination from any angle. Click the toggle to switch to <strong>Fixed Direction</strong> mode, which reveals two sliders: <strong>Horizontal</strong> (0Â°-360Â°) rotates the light around the model, and <strong>Vertical</strong> (-90Â° to +90Â°) adjusts the light height from below (-90Â°) through the horizon (0Â°) to directly above (+90Â°). This is ideal for raking light analysis of surface details like tool marks, inscriptions, or weathering patterns. The light is automatically boosted in fixed mode for better shadow visibility.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Point Annotations</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Click <strong>Point</strong>, then click on the model surface to place a point marker. A popup will appear where you can enter a name, description, author, and external links.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Line Annotations</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Click <strong>Line</strong> to start drawing a polyline. Single-click to add points along the line, double-click to finish and open the annotation popup. Lines are useful for marking edges, boundaries, cracks, or linear features.</p>
                            <p style="margin-top: 10px;"><strong>Surface projection:</strong> By default, line edges are automatically projected onto the model surface â€” they follow the geometry's contour rather than cutting through it as straight lines. This works best on smaller objects with gently curved surfaces. If the projection deviates too far from the intended path (e.g., on complex geometry with deep recesses), MeshNotes falls back to a straight connection for that segment automatically. You can toggle surface projection on or off per annotation using the <strong>"Project line(s) to surface"</strong> checkbox in the annotation popup.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Polygon Annotations</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Click <strong>Polygon</strong> to start drawing a closed shape. Single-click to add vertices, double-click to close the polygon and open the annotation popup. Polygons are useful for marking areas, surfaces, or regions of interest.</p>
                            <p style="margin-top: 10px;">Like line annotations, polygon edges are projected onto the model surface by default, following the geometry's contour. This can be toggled per annotation in the popup.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Surface Annotations</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Click <strong>Surface</strong> to paint directly on the 3D model's mesh faces. Adjust the brush size using the slider (0.1-20% of model size), then click and drag to highlight faces. <strong>Right-click and drag</strong> to rotate the view while painting â€” this lets you paint a continuous surface annotation from multiple angles (e.g., wrapping around a statue's arm). Hold <strong>Shift</strong> while painting to erase. Double-click to finish and open the annotation popup.</p>
                            <p style="margin-top: 10px;">Surface annotations are ideal for marking 3D regions like weathered areas, specific architectural features, or body parts on sculptures that can't be easily captured with flat polygons.</p>
                            <div class="limitation-note">
                                <strong>Performance Note:</strong> The Surface tool uses BVH (Bounding Volume Hierarchy) acceleration for fast spatial queries, significantly improving painting performance. It works best on smaller models (statues, ceramics, artifacts). Performance depends on face count:
                                <ul style="margin: 8px 0 0 20px; padding: 0;">
                                    <li><strong>&lt; 500k faces:</strong> Smooth painting</li>
                                    <li><strong>500k - 3M faces:</strong> May experience slight lag</li>
                                    <li><strong>&gt; 3M faces:</strong> Painting may be slow â€” use a small brush size (0.1â€“0.2) for stable performance, or consider decimating the model</li>
                                </ul>
                                The face count is shown in the bottom-right corner after loading a model.
                            </div>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Box Annotations</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Click <strong>Box</strong> to activate the box tool, then click on the model to place a 3D box annotation. A default-sized box appears at the click location. Boxes are useful for marking volumetric regions like rooms, excavation contexts, architectural spaces, or reconstruction hypotheses.</p>
                            <p style="margin-top: 10px;"><strong>Manipulating boxes:</strong></p>
                            <ul style="margin: 8px 0 0 20px; padding: 0;">
                                <li><strong>Move:</strong> Click and drag the box body to reposition it freely in 3D space</li>
                                <li><strong>Resize:</strong> Drag any corner handle to reshape the box (the opposite corner stays fixed)</li>
                                <li><strong>Rotate:</strong> Right-click and drag on the box body â€” horizontal movement spins the box, vertical movement tilts it</li>
                                <li><strong>Snap:</strong> Hold <code>Shift</code> while rotating to snap to 15Â° increments</li>
                            </ul>
                            <p style="margin-top: 10px;">Unlike other annotations, boxes can float freely in 3D space â€” they don't need to touch the model surface. This makes them ideal for marking "negative space" like missing architectural elements or hypothetical reconstructions. </p>
                                <p>The Box annotation tool was inspired by the <a href="https://cuan3d-be1b98.pages.gitlab.rlp.net/" target="_blank">Cuan3D</a> annotation tool developed by Paula Dicke.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Measurement Tool</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Click <strong>Measure</strong> to activate the measurement tool. Click two points on the model to measure the distance between them. Multiple measurements can be taken and all stay visible with their distance labels. Take a screenshot to document your measurements, then press <code>Esc</code> to clear all. Distances are displayed in "units" â€” the actual unit (meters, millimeters, etc.) depends on how your 3D model was created or exported.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Groups</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Groups help organize annotations by category, phase, or team member. Click <strong>+ Group</strong> in the sidebar to create a new group with a custom name and color. All annotations within a group share that color. Use the eye icon to show/hide all annotations in a group, and the edit icon to modify the group name/color or delete the entire group. A default group is created automatically when you first annotate.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Searching Annotations</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Use the <strong>search box</strong> at the top of the sidebar to filter annotations by name. As you type, annotations and groups that don't match your search term are hidden from the list. Clear the search field to show all annotations again. This is helpful when working with many annotations and you need to quickly find a specific feature.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Model Information</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>At the top of the sidebar is a <strong>Model Information</strong> section for general notes about the entire model. Double-click it to add an introduction, context, or overview that applies to the whole model rather than a specific location. Like annotations, it supports multiple entries from different team members with timestamps â€” useful for documenting the model's origin, processing history, or general observations.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Multi-Entry Annotations</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Each annotation can have multiple entries from different users. When editing an annotation, you'll see all existing entries with their author and timestamp. Click <strong>+ Add Entry</strong> to add your own observation without overwriting previous ones. Each entry has its own description, author name, and links. This is ideal for collaborative documentation where multiple team members contribute observations to the same feature.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Editing Annotations</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Single-click an annotation in the sidebar to focus the camera on it. Double-click to open it for editing. In the edit popup you can: change the annotation name and group, view all entries, edit existing entries (with confirmation to encourage adding new entries), delete individual entries, or delete the entire annotation. Your author name is remembered for convenience.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Moving Annotation Points</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>When no tool is active, you can click and drag any annotation point to reposition it. The cursor changes to a hand when hovering over draggable points. While dragging, the point snaps to the model surface so your annotations stay attached to the geometry.</p>
                            <p style="margin-top: 10px;"><strong>Lines and polygons:</strong> When you drag a point that belongs to a line or polygon, the connected edges update in real-time. If surface projection is enabled for that annotation, the adjacent edges are re-projected onto the model surface as you move the point â€” so the lines continue to follow the surface contour at the new position. This allows you to refine annotation boundaries precisely without recreating them.</p>
                            <p style="margin-top: 10px;"><strong>Note:</strong> Surface annotations (painted faces) cannot be repositioned after creation. To adjust a surface annotation, delete it and paint a new one.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Export &amp; Import</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p><strong>JSON Export:</strong> Click to download all annotations in <strong>W3C Web Annotation</strong> format (.jsonld). This standard format ensures interoperability with other annotation tools and IIIF-compatible viewers. The export includes all entries, timestamps, metadata, groups, and model information.</p>
                            <p style="margin-top: 10px;"><strong>Import:</strong> Click to load annotations from a .json or .jsonld file. MeshNotes supports both the new W3C format and legacy MeshNotes files for backward compatibility. Imported annotations merge with existing ones â€” groups with the same name are combined.</p>
                            <p style="margin-top: 10px; font-size: 12px; color: #888;">The W3C Web Annotation Data Model is a standard for interoperable annotations. Learn more at <a href="https://www.w3.org/TR/annotation-model/" target="_blank">w3.org/TR/annotation-model</a></p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Collaborative Workflow &amp; Merging</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>MeshNotes is designed for teams working on the same 3D model. Multiple people can annotate independently and then merge their work through JSON import/export â€” no server or shared account required.</p>

                            <p style="margin-top: 10px;"><strong>How it works:</strong> Every annotation and every entry within an annotation is assigned a unique ID (UUID) when created. When you import a JSON file, MeshNotes compares these IDs to determine what is new and what already exists:</p>
                            <ul style="margin: 8px 0 0 20px; padding: 0;">
                                <li><strong>New annotations</strong> (unknown UUID) are added alongside your existing ones.</li>
                                <li><strong>Existing annotations</strong> (matching UUID) are updated â€” any new entries from collaborators are merged in, and entries that were edited are updated if the imported version has a newer timestamp.</li>
                                <li><strong>Groups</strong> with the same name are combined. New groups from the imported file are created automatically.</li>
                                <li><strong>Model Information</strong> entries are merged in the same way as annotation entries.</li>
                            </ul>

                            <p style="margin-top: 12px;"><strong>Example team workflow:</strong></p>
                            <ul style="margin: 8px 0 0 20px; padding: 0;">
                                <li><strong>1.</strong> Alice loads the model, creates annotations, and exports a JSON file.</li>
                                <li><strong>2.</strong> Bob loads the same model, imports Alice's JSON, and adds his own annotations and entries.</li>
                                <li><strong>3.</strong> Bob exports his JSON and sends it back to Alice.</li>
                                <li><strong>4.</strong> Alice imports Bob's file â€” she gets Bob's new annotations and entries merged into her existing work. Her own annotations remain untouched, and Bob's additions appear alongside them.</li>
                            </ul>
                            <p style="margin-top: 8px;">This process can be repeated as many times as needed. Each round of import merges only what is new or updated, so you never lose work and annotations are never duplicated.</p>

                            <div class="limitation-note" style="margin-top: 12px;">
                                <strong>Good to know:</strong> The merge uses timestamps to resolve conflicts â€” if two people edit the same entry, the most recent edit wins. To avoid overwriting each other's observations, it's best practice to <strong>add new entries</strong> rather than editing existing ones from other team members.
                            </div>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>About the W3C Web Annotation Format</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>MeshNotes exports annotations following the <a href="https://www.w3.org/TR/annotation-model/" target="_blank">W3C Web Annotation Data Model</a>, an internationally recognized standard for representing annotations on digital resources. This was a deliberate choice to ensure long-term interoperability and academic credibility.</p>
                            <p style="margin-top: 10px;"><strong>What gets stored:</strong> Each annotation is a self-contained JSON-LD object containing its geometry (as a Fragment Selector with 3D coordinates), all entries with author, description, links, and timestamps, as well as the group assignment and annotation type. The exported file is a standard <code>AnnotationCollection</code> that also includes group definitions and model information.</p>
                            <p style="margin-top: 10px;"><strong>Why it matters:</strong> Using a W3C standard means your annotation data is not locked into MeshNotes. The JSON-LD files are human-readable, can be parsed by any programming language, and are compatible with the broader ecosystem of IIIF-based annotation tools and digital humanities infrastructure. This makes MeshNotes annotations suitable for academic publication, archival, and integration into larger research data management workflows.</p>
                            <p style="margin-top: 10px; font-size: 12px; color: #888;">The exported <code>.jsonld</code> files can be opened in any text editor to inspect their contents. Each annotation's geometry is stored as coordinate strings in the <code>FragmentSelector</code> value field.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>PDF Report</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Click <strong>PDF</strong> to generate a comprehensive documentation report of your annotated model. The report is formatted for A4 paper and designed for academic documentation, publication appendices, and archival.</p>

                            <p style="margin-top: 10px;"><strong>Report structure:</strong></p>
                            <ul style="margin: 8px 0 0 20px; padding: 0;">
                                <li><strong>Title page</strong> â€” An overview screenshot of the model with all visible annotations, the model filename, a summary of annotation and group counts, and all Model Information entries.</li>
                                <li><strong>Axis views</strong> â€” Six orthogonal views (Top, Bottom, Front, Back, Left, Right) arranged in an unfolded cube layout, giving a complete overview of the model from all standard directions. If you are in orthographic mode, each view includes a scalebar.</li>
                                <li><strong>Table of contents</strong> â€” A numbered list of all included annotations for quick reference.</li>
                                <li><strong>Annotation pages</strong> â€” One page per annotation with an auto-captured screenshot (the camera automatically focuses on each annotation), the annotation name, type, and group, plus all entry details including author, date, description, and links.</li>
                            </ul>

                            <p style="margin-top: 10px;"><strong>Controlling report content:</strong> Only <strong>visible</strong> annotations are included in the PDF. Use group visibility (the eye icon) to hide annotations you don't want in the report. For example, you could hide preliminary annotations and only include finalized ones, or generate separate reports per group by toggling visibility before each export.</p>

                            <div class="limitation-note" style="margin-top: 12px;">
                                <strong>Note:</strong> During PDF generation, the camera and lighting are temporarily adjusted for consistent results. All screenshots in the report use camera-linked lighting regardless of your current light source setting, ensuring uniform illumination across all views. Your original camera position and lighting settings are restored after the report is generated.
                            </div>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Screenshots &amp; Scalebar</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Click <strong>Screenshot</strong> to save the current view as a PNG image. The screenshot includes all visible annotations, name labels, and measurement lines exactly as shown on screen â€” useful for documentation, reports, and publications.</p>
                            <p style="margin-top: 10px;"><strong>Scalebar:</strong> In <strong>Orthographic</strong> camera mode, screenshots automatically include a scalebar in the bottom-right corner. The scalebar shows the real-world distance based on the model's coordinate system, with values rounded to clean numbers (e.g., 1, 2, 5, 10, 20, 50...) for readability. The unit depends on how your 3D model was originally created or exported (e.g., millimeters, centimeters, or meters).</p>
                            <p style="margin-top: 10px;">If you take a screenshot while in <strong>Perspective</strong> mode, MeshNotes will ask whether you want to switch to Orthographic view first. A scalebar can only be accurate in orthographic mode, where scale is uniform across the entire image â€” in perspective view, objects further from the camera appear smaller, making a single scalebar misleading.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Navigation Controls</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p><strong>Left-click + drag:</strong> Rotate the view around the model. <strong>Right-click + drag:</strong> Pan the view. <strong>Scroll wheel:</strong> Zoom in/out. <strong>Escape:</strong> Cancel current drawing action, deselect tool, or clear all measurements.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Camera View</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Click the <strong>Perspective/Orthographic</strong> button in the top-right corner of the viewport to toggle between camera modes. <strong>Perspective</strong> view shows depth with natural foreshortening. <strong>Orthographic</strong> view removes perspective distortion, making parallel lines appear parallel â€” useful for accurate measurements, technical drawings, and architectural documentation.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>View Helper</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>In the top-right corner of the viewport you'll find the <strong>View Helper</strong>, an interactive widget provided by the <a href="https://threejs.org/docs/#examples/en/helpers/ViewHelper" target="_blank">Three.js library</a>. It displays three colored axis lines â€” <strong style="color: #ff4444;">X (red)</strong>, <strong style="color: #44bb44;">Y (green)</strong>, and <strong style="color: #4488ff;">Z (blue)</strong> â€” radiating from a central point, with labeled circles at each positive axis end and smaller circles at each negative end. As you rotate the model, the View Helper rotates along with it, always showing your current camera orientation at a glance.</p>
                            <p style="margin-top: 10px;"><strong>Click any axis circle</strong> to smoothly animate the camera to that standard view direction (e.g., click the Z circle for a top-down view, click the Y circle for a front view). This is particularly useful for consistent documentation â€” for example, always capturing the same angle of an artifact for comparison, or quickly switching between front and side views while annotating.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Tips</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>Use the opacity slider to see annotations on the back side of the model. Group annotations by excavation phase, feature type, or team member for better organization. Export frequently to back up your work. The tool runs entirely in your browser â€” your data stays on your computer unless you share the exported JSON file.</p>
                        </div>
                    </div>

                    <div class="manual-item">
                        <div class="manual-item-header">
                            <span>Data Privacy &amp; Offline Use</span>
                            <span class="toggle-icon">â–¶</span>
                        </div>
                        <div class="manual-item-content">
                            <p>MeshNotes runs entirely in your web browser. No data is uploaded to any server â€” your 3D models, annotations, and all other data remain on your computer at all times. The tool does not use cookies, analytics, tracking, or any external services.</p>
                            <p style="margin-top: 10px;">When hosted on GitHub Pages, the HTML file itself is downloaded once, after which all processing happens locally. You can also save the HTML file to your computer and open it directly in a browser for fully offline use â€” no internet connection required.</p>
                            <p style="margin-top: 10px;">Exported JSON and PDF files are generated locally in your browser and saved directly to your downloads folder. Sharing annotation data with collaborators is always an explicit action on your part â€” you decide when and with whom to share your exported files. This makes MeshNotes suitable for documenting sensitive or unpublished archaeological sites where data confidentiality is important.</p>
                        </div>
                    </div>

                    <button class="btn-download-manual" id="btn-download-manual">ðŸ“„ Download Manual as PDF</button>

                </section>

                <section>
                    <h3>Credits & License</h3>
                    <p>MeshNotes uses the following open-source libraries:</p>
                    <ul style="margin: 12px 0 12px 20px; color: #ccc;">
                        <li><a href="https://threejs.org/" target="_blank">Three.js</a> (MIT License) â€” 3D rendering</li>
                        <li><a href="https://github.com/gkjohnson/three-mesh-bvh" target="_blank">three-mesh-bvh</a> (MIT License) â€” Accelerated raycasting &amp; surface projection</li>
                        <li><a href="https://github.com/parallax/jsPDF" target="_blank">jsPDF</a> (MIT License) â€” PDF generation</li>
                    </ul>
                    <p>MeshNotes itself is licensed under the <strong>MIT License</strong> â€” free to use, modify, and distribute. See the <a href="https://github.com/NilsSchnorr/MeshNotes/blob/main/LICENSE" target="_blank">LICENSE file</a> for details.</p>
                </section>
            </div>
        </div>
    </div>

    <!-- Legal Modal -->
    <div id="legal-overlay">
        <div id="legal-modal">
            <div id="legal-modal-header">
                <h2>Legal Information and Data Policy / Impressum und Datenschutz</h2>
                <button id="legal-modal-close">âœ•</button>
            </div>
            <div id="legal-modal-content">
                <section>
                    <div style="background: #041D31; padding: 16px; border-radius: 6px; margin-bottom: 24px;">
                        <p style="margin-bottom: 8px;"><strong>ðŸ”— Open Source Repository</strong></p>
                        <p style="margin-bottom: 0;">Want to use the tool without accessing this website? Feel free to download or clone the repository at <a href="https://github.com/NilsSchnorr/MeshNotes" target="_blank">github.com/NilsSchnorr/MeshNotes</a></p>
                    </div>
                </section>

                <!-- ENGLISH VERSION -->
                <section>
                    <h3>Legal Notice (English)</h3>
                    <p>
                        <strong>Nils Schnorr</strong><br>
                        <a href="mailto:nils.schnorr@uni-saarland.de">nils.schnorr@uni-saarland.de</a><br>
                        UniversitÃ¤t des Saarlandes<br>
                        FakultÃ¤t P - Altertumswissenschaften<br>
                        Klassische ArchÃ¤ologie<br>
                        Campus GebÃ¤ude B3.1 Raum 1.22<br>
                        66123 SaarbrÃ¼cken, Germany
                    </p>
                    
                    <h4>Disclaimer</h4>
                    
                    <p><strong>Liability for Content</strong><br>
                    As a service provider, we are responsible for our own content on these pages in accordance with general legislation pursuant to Section 7 (1) of the German Telemedia Act (TMG). However, according to Sections 8 to 10 TMG, we are not obligated to monitor transmitted or stored third-party information or to investigate circumstances that indicate illegal activity. Obligations to remove or block the use of information under general law remain unaffected. However, liability in this regard is only possible from the time of knowledge of a specific infringement. Upon becoming aware of such violations, we will remove this content immediately.</p>
                    
                    <p><strong>Liability for Links</strong><br>
                    Our website contains links to external third-party websites over whose content we have no control. Therefore, we cannot accept any liability for this third-party content. The respective provider or operator of the linked pages is always responsible for the content of those pages. The linked pages were checked for possible legal violations at the time of linking. Illegal content was not recognizable at the time of linking. Permanent content control of the linked pages is not reasonable without concrete evidence of a violation of the law. Upon becoming aware of legal violations, we will remove such links immediately.</p>
                    
                    <p><strong>Copyright</strong><br>
                    The content and works created by the site operators on these pages are subject to German copyright law. Duplication, processing, distribution, and any kind of exploitation outside the limits of copyright law require the written consent of the respective author or creator. Insofar as the content on this site was not created by the operator, the copyrights of third parties are respected. In particular, third-party content is marked as such. Should you nevertheless become aware of a copyright infringement, please inform us accordingly. Upon becoming aware of legal violations, we will remove such content immediately.</p>
                </section>

                <section>
                    <h3>Data Policy (English)</h3>
                    
                    <p>The GDPR requires transparency about how and why your personal data is processed.</p>
                    
                    <h4>Hosting</h4>
                    <p>The host operates a web server to deliver static pages.</p>
                    
                    <p><strong>Hosting via GitHub Pages</strong><br>
                    This tool is open source and hosted on "GitHub Pages". GitHub declares its handling of data in their <a href="https://docs.github.com/en/site-policy/privacy-policies/github-general-privacy-statement" target="_blank">Privacy Policy</a>.</p>
                    
                    <p style="font-style: italic; padding-left: 16px; border-left: 3px solid #1A5A8A;">"... we only collect the minimum amount of personal information that is necessary to fulfill the purpose of your interaction with us ..."</p>
                    
                    <p>As a US company, GitHub complies with the Privacy Shield requirements for users from the EU.</p>
                    
                    <p><strong>Hosting as a Static Website</strong><br>
                    This is a static website, meaning this "tool" is pre-built on the host's web server and delivered unchanged when you open the tool in your browser. During such an HTTP request, your browser transmits your IP address and the path of the requested page. This is necessary for the server to load and deliver the requested page to your browser.</p>
                    
                    <p><strong>Server Logs</strong><br>
                    During the HTTP request, in addition to your IP address and the requested page, the referrer (the page where you clicked the link), information about your browser, and your operating system are transmitted to the web server. The host stores this information in server logs to monitor operations so that disruptions and misuse can be quickly detected and resolved.</p>
                    
                    <h4>Business-Related Processing</h4>
                    <p>This tool is open-source and non-commercial. No data from you is processed in this regard by the author of "MeshNotes".</p>
                    
                    <h4>Open Source Contributions</h4>
                    <p>"MeshNotes" is an open-source project hosted at <a href="https://github.com/NilsSchnorr/MeshNotes" target="_blank">github.com/NilsSchnorr/MeshNotes</a>. You can contribute if you wish, for example by submitting a pull request on GitHub. Please note: This project is published under an MIT license, which will also apply to your contributions if the pull requests are accepted.</p>
                </section>

                <hr style="border: none; border-top: 2px solid #1A5A8A; margin: 32px 0;">

                <!-- GERMAN VERSION -->
                <section>
                    <h3>Legal / Impressum (Deutsch)</h3>
                    <p>
                        <strong>Nils Schnorr</strong><br>
                        <a href="mailto:nils.schnorr@uni-saarland.de">nils.schnorr@uni-saarland.de</a><br>
                        UniversitÃ¤t des Saarlandes<br>
                        FakultÃ¤t P - Altertumswissenschaften<br>
                        Klassische ArchÃ¤ologie<br>
                        Campus GebÃ¤ude B3.1 Raum 1.22<br>
                        66123 SaarbrÃ¼cken, Germany
                    </p>
                    
                    <h4>Haftungsausschluss (Disclaimer)</h4>
                    
                    <p><strong>Haftung fÃ¼r Inhalte</strong><br>
                    Als Diensteanbieter sind wir gemÃ¤ÃŸ Â§ 7 Abs.1 TMG fÃ¼r eigene Inhalte auf diesen Seiten nach den allgemeinen Gesetzen verantwortlich. Nach Â§Â§ 8 bis 10 TMG sind wir als Diensteanbieter jedoch nicht verpflichtet, Ã¼bermittelte oder gespeicherte fremde Informationen zu Ã¼berwachen oder nach UmstÃ¤nden zu forschen, die auf eine rechtswidrige TÃ¤tigkeit hinweisen. Verpflichtungen zur Entfernung oder Sperrung der Nutzung von Informationen nach den allgemeinen Gesetzen bleiben hiervon unberÃ¼hrt. Eine diesbezÃ¼gliche Haftung ist jedoch erst ab dem Zeitpunkt der Kenntnis einer konkreten Rechtsverletzung mÃ¶glich. Bei Bekanntwerden von entsprechenden Rechtsverletzungen werden wir diese Inhalte umgehend entfernen.</p>
                    
                    <p><strong>Haftung fÃ¼r Links</strong><br>
                    Unser Angebot enthÃ¤lt Links zu externen Webseiten Dritter, auf deren Inhalte wir keinen Einfluss haben. Deshalb kÃ¶nnen wir fÃ¼r diese fremden Inhalte auch keine GewÃ¤hr Ã¼bernehmen. FÃ¼r die Inhalte der verlinkten Seiten ist stets der jeweilige Anbieter oder Betreiber der Seiten verantwortlich. Die verlinkten Seiten wurden zum Zeitpunkt der Verlinkung auf mÃ¶gliche RechtsverstÃ¶ÃŸe Ã¼berprÃ¼ft. Rechtswidrige Inhalte waren zum Zeitpunkt der Verlinkung nicht erkennbar. Eine permanente inhaltliche Kontrolle der verlinkten Seiten ist jedoch ohne konkrete Anhaltspunkte einer Rechtsverletzung nicht zumutbar. Bei Bekanntwerden von Rechtsverletzungen werden wir derartige Links umgehend entfernen.</p>
                    
                    <p><strong>Urheberrecht</strong><br>
                    Die durch die Seitenbetreiber erstellten Inhalte und Werke auf diesen Seiten unterliegen dem deutschen Urheberrecht. Die VervielfÃ¤ltigung, Bearbeitung, Verbreitung und jede Art der Verwertung auÃŸerhalb der Grenzen des Urheberrechtes bedÃ¼rfen der schriftlichen Zustimmung des jeweiligen Autors bzw. Erstellers. Soweit die Inhalte auf dieser Seite nicht vom Betreiber erstellt wurden, werden die Urheberrechte Dritter beachtet. Insbesondere werden Inhalte Dritter als solche gekennzeichnet. Sollten Sie trotzdem auf eine Urheberrechtsverletzung aufmerksam werden, bitten wir um einen entsprechenden Hinweis. Bei Bekanntwerden von Rechtsverletzungen werden wir derartige Inhalte umgehend entfernen.</p>
                    
                    <p style="color: #888; font-size: 12px;">Quelle: eRecht24</p>
                </section>

                <section>
                    <h3>Datenschutz (Deutsch)</h3>
                    
                    <p>Die DSGVO sieht vor, dass Sie Transparenz darÃ¼ber erhalten, wie und wozu Ihre personenbezogenen Daten verarbeitet werden.</p>
                    
                    <h4>Hosting</h4>
                    <p>Der Hoster betreibt einen Web-Server zur Auslieferung der statischer Seiten.</p>
                    
                    <p><strong>Hosting durch GitHub Pages</strong><br>
                    Dieses Tool ist Open Source und wird bei "GitHub Pages" gehosted. GitHub deklariert seinen Umgang mit Daten in dieser <a href="https://docs.github.com/en/site-policy/privacy-policies/github-general-privacy-statement" target="_blank">Privacy Policy</a>.</p>
                    
                    <p style="font-style: italic; padding-left: 16px; border-left: 3px solid #1A5A8A;">"... we only collect the minimum amount of personal information that is necessary to fulfill the purpose of your interaction with us ..."</p>
                    
                    <p>GitHub erfÃ¼llt als US-Unternehmen die Anforderungen des Privacy Shield fÃ¼r Nutzer aus der EU.</p>
                    
                    <p><strong>Hosting als statische Website</strong><br>
                    Dies ist eine statische Website, d.h. dieses â€žTool" liegt vorgefertigt auf dem Web-Server des Hosters und wird unverÃ¤ndert ausgeliefert, sobald Sie das Tool im Browser Ã¶ffnen. Bei einem solchen http-Request Ã¼bertrÃ¤gt Ihr Browser Ihre IP-Adresse und den Pfad der angeforderten Seite. Dies ist notwendig, damit der Browser die angeforderte Seite laden und an Ihren Browser ausliefern kann.</p>
                    
                    <p><strong>Server-Logs</strong><br>
                    Beim http-Request werden neben Ihrer IP-Adresse und der angeforderten Seite auch der Referrer (die Seite auf der Sie den Link geklickt haben), Informationen Ã¼ber Ihren Browser und Ihr Betriebssystem an den Web-Server Ã¼bermittelt. Der Hoster speichert diese Informationen in Server-Logs, um den Betrieb zu Ã¼berwachen, damit StÃ¶rungen und MissbrauchsfÃ¤lle schnell erkannt und behoben werden kÃ¶nnen.</p>
                    
                    <h4>GeschÃ¤ftsbezogene Verarbeitung</h4>
                    <p>Dieses Tool ist Open-Source und nicht kommerziell. Es werden keine Daten von Ihnen in diesem Hinblick vom Autor von â€žMeshNotes" verarbeitet.</p>
                    
                    <h4>Open-Source-BeitrÃ¤ge</h4>
                    <p>â€žMeshNotes" ist ein Open-Source-Projekt, gehostet auf <a href="https://github.com/NilsSchnorr/MeshNotes" target="_blank">github.com/NilsSchnorr/MeshNotes</a>. Sie kÃ¶nnen dazu beitragen, wenn Sie mÃ¶chten, z. B. durch einen Pull-Request auf GitHub. Beachten Sie dabei: Dieses Projekt ist unter einer MIT Lizenz verÃ¶ffentlicht, diese gilt dann auch fÃ¼r Ihre BeitrÃ¤ge, wenn die Pull-Requests angenommen werden.</p>
                </section>
            </div>
        </div>
    </div>

    <div id="toolbar">
        <input type="file" id="file-input" accept=".glb,.gltf,.obj,.ply">
        <input type="file" id="import-input" accept=".json,.jsonld">
        <input type="file" id="obj-material-input" accept=".mtl,.jpg,.jpeg,.png,.tif,.tiff" multiple>
        <input type="file" id="ply-texture-input" accept=".jpg,.jpeg,.png,.tif,.tiff">
        
        <button class="tool-btn" id="btn-load" title="Load 3D Model (GLB, GLTF, OBJ, PLY)">ðŸ“‚ Load Model</button>
        <button class="tool-btn" id="btn-texture" disabled title="Toggle Texture">ðŸ–¼ï¸ Texture</button>
        
        <div class="tool-separator"></div>
        
        <button class="tool-btn" id="btn-point" disabled title="Add Point Annotation">ðŸ“ Point</button>
        <button class="tool-btn" id="btn-line" disabled title="Add Line Annotation">ðŸ“ Line</button>
        <button class="tool-btn" id="btn-polygon" disabled title="Add Polygon Annotation">â¬¡ Polygon</button>
        <button class="tool-btn" id="btn-surface" disabled title="Add Surface Annotation">ðŸŽ¨ Surface</button>
        <button class="tool-btn" id="btn-box" disabled title="Add Box Annotation">ðŸ“¦ Box</button>
        <button class="tool-btn" id="btn-measure" disabled title="Measure Distance">ðŸ“ Measure</button>
        
        <div class="tool-separator"></div>
        
        <button class="tool-btn" id="btn-screenshot" disabled title="Take Screenshot">ðŸ“· Screenshot</button>
        <button class="tool-btn" id="btn-export" disabled title="Export Annotations as JSON">ðŸ’¾ JSON</button>
        <button class="tool-btn" id="btn-export-pdf" disabled title="Export as PDF Report">ðŸ“„ PDF</button>
        <button class="tool-btn" id="btn-import" title="Import Annotations">ðŸ“¥ Import</button>
        
        <button id="camera-toggle" title="Toggle Orthographic/Perspective View">Perspective</button>
    </div>

    <div id="container">
        <div id="viewport">
            <canvas id="canvas"></canvas>

            <div id="measurement-display">
                <div id="measurements-list"></div>
                <div class="hint">Click two points to measure. Press Esc to clear all.</div>
            </div>

            <div id="brush-display">
                <div class="brush-controls">
                    <label>
                        <span>Brush Size</span>
                        <span id="brush-value">5%</span>
                    </label>
                    <input type="range" id="brush-slider" min="0.1" max="20" value="5" step="0.1">
                </div>
                <div class="hint">Click/drag to paint. Hold Shift to erase. Double-click to finish.</div>
            </div>

            <div id="instructions">
                <strong>Controls:</strong> Left-drag rotate Â· Right-drag pan Â· Scroll zoom
            </div>

            <div id="model-stats">
                <span id="face-count"></span>
            </div>

            <div id="viewhelper-container">
                <canvas id="viewhelper-canvas" width="128" height="128"></canvas>
            </div>

            <div id="sliders-panel">
                <div id="sliders-panel-toggle">â–¼</div>
                <div id="sliders-panel-content">
                    <div class="light-mode-row">
                    <label>Light Source</label>
                    <button class="light-toggle-btn active" id="light-toggle" title="Toggle between camera-linked and fixed light">Follows Camera</button>
                </div>
                <div id="light-direction-row">
                    <div class="light-sliders-group">
                        <div class="slider-row">
                            <label>
                                <span>Horizontal</span>
                                <span id="light-azimuth-value">0Â°</span>
                            </label>
                            <input type="range" id="light-azimuth-slider" min="0" max="360" value="0">
                        </div>
                        <div class="slider-row">
                            <label>
                                <span>Vertical</span>
                                <span id="light-elevation-value">45Â°</span>
                            </label>
                            <input type="range" id="light-elevation-slider" min="-90" max="90" value="45">
                        </div>
                    </div>
                </div>
                <div class="slider-row">
                    <label>
                        <span>Brightness</span>
                        <span id="brightness-value">100%</span>
                    </label>
                    <input type="range" id="brightness-slider" min="0" max="300" value="100">
                </div>
                <div class="slider-row slider-divider">
                    <label>
                        <span>Model Opacity</span>
                        <span id="opacity-value">100%</span>
                    </label>
                    <input type="range" id="opacity-slider" min="10" max="100" value="100">
                </div>
                <div class="slider-row">
                    <label>
                        <span>Point Size</span>
                        <span id="point-size-value">100%</span>
                    </label>
                    <input type="range" id="point-size-slider" min="25" max="500" value="100">
                </div>
                <div class="slider-row">
                    <label>
                        <span>Text Size</span>
                        <span id="text-size-value">100%</span>
                    </label>
                    <input type="range" id="text-size-slider" min="25" max="300" value="100">
                </div>
                </div>
            </div>

            <div id="status"></div>
            <div id="loading">Loading model...</div>

            <!-- Annotation Popup -->
            <div class="popup" id="annotation-popup">
                <h3 id="popup-title">New Annotation</h3>
                
                <div id="popup-main-fields">
                    <label for="ann-name">Name *</label>
                    <input type="text" id="ann-name" placeholder="e.g., Door remains">
                    
                    <label for="ann-group">Group</label>
                    <select id="ann-group"></select>
                    
                    <div id="surface-projection-toggle" style="display: none;">
                        <label class="projection-checkbox-label">
                            <input type="checkbox" id="ann-surface-projection" checked>
                            Project line(s) to surface
                        </label>
                    </div>
                </div>
                
                <!-- Entries container (shown when editing) -->
                <div id="entries-container" style="display: none;">
                    <div id="entries-list"></div>
                    <button class="btn-add-entry" id="btn-add-entry">+ Add Entry</button>
                </div>
                
                <!-- New entry form (shown when creating or adding entry) -->
                <div id="new-entry-form">
                    <label for="ann-description">Description</label>
                    <textarea id="ann-description" placeholder="Describe what you observe..."></textarea>
                    
                    <label for="ann-author">Author</label>
                    <input type="text" id="ann-author" placeholder="Your name">
                    
                    <div class="links-section">
                        <label>External Links</label>
                        <div class="links-list" id="ann-links"></div>
                        <div class="add-link-row">
                            <input type="text" id="ann-new-link" placeholder="https://...">
                            <button class="btn-save" id="btn-add-link">+</button>
                        </div>
                    </div>
                </div>
                
                <div class="btn-row">
                    <button class="btn-delete" id="btn-popup-delete" style="display: none;">Delete Annotation</button>
                    <button class="btn-cancel" id="btn-popup-cancel">Cancel</button>
                    <button class="btn-save" id="btn-popup-save">Save</button>
                </div>
            </div>

            <!-- Confirmation Dialog -->
            <div class="confirm-overlay" id="confirm-overlay">
                <div class="confirm-dialog">
                    <p id="confirm-message">Are you sure?</p>
                    <div class="btn-row">
                        <button class="btn-cancel" id="confirm-cancel">Cancel</button>
                        <button class="btn-save" id="confirm-ok">Confirm</button>
                    </div>
                </div>
            </div>

            <!-- Scalebar Confirmation Dialog -->
            <div class="confirm-overlay" id="scalebar-confirm-overlay">
                <div class="confirm-dialog" style="max-width: 450px;">
                    <p id="scalebar-confirm-message">You are currently in <strong>Perspective</strong> view. A scalebar can only be included in <strong>Orthographic</strong> view where scale is uniform across the image.</p>
                    <p style="margin-top: 12px; font-size: 12px; color: #888;">Would you like to switch to Orthographic view to include a scalebar?</p>
                    <div class="btn-row" style="margin-top: 16px;">
                        <button class="btn-cancel" id="scalebar-no-switch">Continue without scalebar</button>
                        <button class="btn-save" id="scalebar-switch">Switch & include scalebar</button>
                    </div>
                </div>
            </div>

            <!-- OBJ Material Dialog -->
            <div id="obj-dialog-overlay">
                <div class="obj-dialog">
                    <h3>OBJ File Detected</h3>
                    <p>Would you like to add material (.mtl) and/or texture files (.jpg, .png)?<br>You can select one or multiple files.</p>
                    <div class="axis-selector">
                        <label class="axis-heading">Model up-axis orientation:</label>
                        <div class="axis-options">
                            <label><input type="radio" name="obj-up-axis" value="z-up" checked> Z-up (typically Metashape, CloudCompare, MeshLab, and others)</label>
                            <label><input type="radio" name="obj-up-axis" value="y-up"> Y-up (typically Blender OBJ export)</label>
                        </div>
                    </div>
                    <div class="btn-row">
                        <button class="btn-secondary" id="obj-load-plain">Load without materials</button>
                        <button class="btn-primary" id="obj-add-materials">Add Textures & Materials</button>
                    </div>
                </div>
            </div>

            <div id="ply-dialog-overlay">
                <div class="obj-dialog">
                    <h3>PLY File Detected</h3>
                    <p>Would you like to add a texture image (.jpg, .png)?<br>This requires your PLY to contain UV coordinates.</p>
                    <div class="axis-selector">
                        <label class="axis-heading">Model up-axis orientation:</label>
                        <div class="axis-options">
                            <label><input type="radio" name="ply-up-axis" value="z-up" checked> Z-up (typically Metashape, CloudCompare, MeshLab, Blender, and others)</label>
                            <label><input type="radio" name="ply-up-axis" value="y-up"> Y-up (e.g. manually converted)</label>
                        </div>
                    </div>
                    <div class="btn-row">
                        <button class="btn-secondary" id="ply-load-plain">Load without texture</button>
                        <button class="btn-primary" id="ply-add-texture">Add Texture</button>
                    </div>
                </div>
            </div>

            <!-- Group Popup -->
            <div class="popup" id="group-popup">
                <h3 id="group-popup-title">New Group</h3>
                <label for="group-name">Name</label>
                <input type="text" id="group-name" placeholder="e.g., Phase 1 features">
                
                <label for="group-color">Color</label>
                <input type="color" id="group-color" value="#EDC040">
                
                <div class="btn-row">
                    <button class="btn-delete" id="btn-group-delete" style="display: none;">Delete</button>
                    <button class="btn-cancel" id="btn-group-cancel">Cancel</button>
                    <button class="btn-save" id="btn-group-save">Save</button>
                </div>
            </div>
        </div>

        <div id="sidebar">
            <div class="sidebar-section" style="flex: 1; overflow-y: auto;">
                <h2>
                    Annotations
                    <button class="tool-btn" id="btn-add-group">+ Group</button>
                </h2>
                
                <!-- Search Box -->
                <div id="search-box">
                    <input type="text" id="search-input" placeholder="Search annotations...">
                </div>
                
                <!-- Model Information -->
                <div id="model-info-section">
                    <div class="model-info-item" id="model-info-item">
                        <div class="model-info-header">
                            <span class="model-info-icon">ðŸ“‹</span>
                            <span class="model-info-title">Model Information</span>
                        </div>
                        <div class="model-info-subtitle" id="model-info-subtitle">No entries yet</div>
                    </div>
                </div>
                
                <div id="groups-container">
                    <div class="empty-state" id="no-groups">No annotations yet. Load a model and use the tools to annotate.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- jsPDF library for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
                "three-mesh-bvh": "https://cdn.jsdelivr.net/npm/three-mesh-bvh@0.8.0/+esm"
            }
        }
    </script>

    <script type="module" src="js/main.js"></script>
</body>
</html>
